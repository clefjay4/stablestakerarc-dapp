<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StableStakerArc DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0d1117;
      color: #e6edf3;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    h1 { color: #58a6ff; }
    input, button {
      padding: 10px;
      margin: 10px;
      border-radius: 6px;
      border: none;
      font-size: 16px;
    }
    button {
      background-color: #238636;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #2ea043;
    }
    .card {
      background-color: #161b22;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>StableStakerArc DApp</h1>
    <button id="connectWallet">ðŸ”— Connect Wallet</button>
    <p id="walletAddress"></p>

    <h3>Stake USDC</h3>
    <input type="number" id="stakeAmount" placeholder="Amount in USDC" />
    <button id="approve">Approve USDC</button>
    <button id="stake">Stake</button>

    <h3>Your Stake Info</h3>
    <button id="getStake">Get My Stake</button>
    <p id="stakeInfo">---</p>

    <h3>Withdraw Stake</h3>
    <button id="withdraw">Withdraw</button>
  </div>

  <script>
    const contractAddress = "0xc3B2a6DD055F9c36D55A1D9267B94008d1789472";
    const usdcAddress = "0x3600000000000000000000000000000000000000";
    const usdcDecimals = 6;

    const contractABI = [
      "function stake(uint256 _amount) public",
      "function withdraw() public",
      "function getMyStake() public view returns (uint256, uint256)",
      "function usdc() public view returns (address)"
    ];

    const erc20ABI = [
      "function approve(address spender, uint256 amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint256)",
      "function balanceOf(address owner) public view returns (uint256)"
    ];

    let provider, signer, contract, usdc;

    document.getElementById("connectWallet").onclick = async () => {
      if (!window.ethereum) {
        alert("MetaMask not found!");
        return;
      }
      provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      document.getElementById("walletAddress").innerText = `Connected: ${await signer.getAddress()}`;
      contract = new ethers.Contract(contractAddress, contractABI, signer);
      usdc = new ethers.Contract(usdcAddress, erc20ABI, signer);
    };

    document.getElementById("approve").onclick = async () => {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount) return alert("Enter amount");
      const scaled = ethers.parseUnits(amount, usdcDecimals);
      const tx = await usdc.approve(contractAddress, scaled);
      await tx.wait();
      alert("USDC approved!");
    };

    document.getElementById("stake").onclick = async () => {
      const amount = document.getElementById("stakeAmount").value;
      if (!amount) return alert("Enter amount");
      const scaled = ethers.parseUnits(amount, usdcDecimals);
      const tx = await contract.stake(scaled);
      await tx.wait();
      alert("Stake successful!");
    };

    document.getElementById("getStake").onclick = async () => {
      const result = await contract.getMyStake();
      const amount = Number(result[0]) / 10 ** usdcDecimals;
      const reward = Number(result[1]) / 10 ** usdcDecimals;
      document.getElementById("stakeInfo").innerText = `Amount: ${amount} USDC | Reward: ${reward} USDC`;
    };

    document.getElementById("withdraw").onclick = async () => {
      const tx = await contract.withdraw();
      await tx.wait();
      alert("Withdrawal complete!");
    };
  </script>
</body>
</html>
